<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>입학설명회 신청 확인</title>
    </head>
<body>
    <div class="container">
        <button onclick="checkSubmission()">신청 확인</button>
        <div id="result" class="result"></div>
    </div>

    <script>
        // --- 여기부터 아래까지, 위에 보여주신 JavaScript 코드가 정확히 들어가야 합니다. ---
        async function checkSubmission() {
            const name = document.getElementById("name").value.trim();
            const phone = document.getElementById("phone").value.trim();
            const resultDiv = document.getElementById("result");
            const checkButton = document.querySelector('button');

            resultDiv.style.display = "none";
            resultDiv.className = "result";
            resultDiv.innerText = "";
            checkButton.disabled = false;

            if (!name || !phone) {
                resultDiv.style.display = "block";
                resultDiv.className = "result error";
                resultDiv.innerText = "이름과 연락처를 모두 입력해주세요.";
                return;
            }

            resultDiv.style.display = "block";
            resultDiv.className = "result loading";
            resultDiv.innerText = "결과를 불러오는 중입니다. 잠시 기다려 주세요...";
            checkButton.disabled = true;

            try {
                const appsScriptUrl = `https://script.google.com/macros/s/AKfycbzN9Uh01HzhmstcnzVcwLI7STnP4Ya17V4kes4K_n3jWfAH6oW2F8doGr_07yaDe7yd/exec`;
                const response = await fetch(`${appsScriptUrl}?name=${encodeURIComponent(name)}&phone=${encodeURIComponent(phone)}`);
                const data = await response.json();

                checkButton.disabled = false;

                if (data.error) {
                    resultDiv.className = "result error";
                    resultDiv.innerText = data.error;
                } else {
                    resultDiv.className = "result";
                    let rankMessage = '';
                    if (data.rank) {
                        rankMessage = `\n\n📢 ${data.major} 신청자 중 ${data.rank}번째입니다.`;
                    }

                    let attendeesInfo = '';
                    if (data.attendees !== undefined && data.attendees !== null && data.attendees !== '') {
                        attendeesInfo = `참석 인원: ${data.attendees}\n`;
                    }

                    let otherInfoLine = '';
                    if (data.otherInfo !== undefined && data.otherInfo !== null && data.otherInfo !== '') {
                        otherInfoLine = `그 외 참가자 정보: ${data.otherInfo}\n`;
                    }

                    resultDiv.innerText =
                        `✅ 신청 내역 확인\n\n` +
                        `이름: ${data.name}\n` +
                        `전공 선택: ${data.major}\n` +
                        attendeesInfo +
                        otherInfoLine +
                        `신청 시간: ${data.timestamp}` +
                        rankMessage;
                }
            } catch (err) {
                console.error("Fetch error:", err);
                checkButton.disabled = false;
                resultDiv.className = "result error";
                resultDiv.innerText = "요청 처리 중 오류가 발생했습니다. 잠시 후 다시 시도해주세요.";
            }
        }
        // --- 여기 위에까지가 해당 코드입니다. ---
    </script>
</body>
</html>
