// JavaScript <script> íƒœê·¸ ì•ˆì— checkSubmission í•¨ìˆ˜ ë‚´ë¶€
async function checkSubmission() {
  const name = document.getElementById("name").value.trim();
  const phone = document.getElementById("phone").value.trim();
  const resultDiv = document.getElementById("result");
  const checkButton = document.querySelector('button');

  resultDiv.style.display = "none";
  resultDiv.className = "result";
  resultDiv.innerText = "";
  checkButton.disabled = false;

  if (!name || !phone) {
    resultDiv.style.display = "block";
    resultDiv.className = "result error";
    resultDiv.innerText = "ì´ë¦„ê³¼ ì—°ë½ì²˜ë¥¼ ëª¨ë‘ ì…ë ¥í•´ì£¼ì„¸ìš”.";
    return;
  }

  resultDiv.style.display = "block";
  resultDiv.className = "result loading";
  resultDiv.innerText = "ê²°ê³¼ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘ì…ë‹ˆë‹¤. ì ì‹œ ê¸°ë‹¤ë ¤ ì£¼ì„¸ìš”...";
  checkButton.disabled = true;

  try {
    // ğŸ’¡ ë³€ê²½: Apps Script ì›¹ ì•± URLì„ ë°©ê¸ˆ ë°°í¬í•˜ì‹  URLë¡œ ì—…ë°ì´íŠ¸í•©ë‹ˆë‹¤.
    const appsScriptUrl = `https://script.google.com/macros/s/AKfycbzN9Uh01HzhmstcnzVcwLI7STnP4Ya17V4kes4K_n3jWfAH6oW2F8doGr_07yaDe7yd/exec`;
    const response = await fetch(`${appsScriptUrl}?name=${encodeURIComponent(name)}&phone=${encodeURIComponent(phone)}`);
    const data = await response.json();

    checkButton.disabled = false;

    if (data.error) {
      resultDiv.className = "result error";
      resultDiv.innerText = data.error;
    } else {
      // ğŸ’¡ ë³€ê²½: ê²°ê³¼ í‘œì‹œ ë‚´ìš©ì„ ìƒˆë¡œìš´ ë°ì´í„° êµ¬ì¡°ì— ë§ì¶° ì—…ë°ì´íŠ¸í•©ë‹ˆë‹¤.
      resultDiv.className = "result";
      let rankMessage = '';
      if (data.rank) {
        rankMessage = `\n\nğŸ“¢ ${data.major} ì‹ ì²­ì ì¤‘ ${data.rank}ë²ˆì§¸ì…ë‹ˆë‹¤.`;
      }

      // ì°¸ì„ ì¸ì› ì •ë³´ì— ëŒ€í•œ ì¡°ê±´ë¶€ í‘œì‹œ ë¡œì§ ì¶”ê°€
      let attendeesInfo = '';
      if (data.attendees !== undefined && data.attendees !== null && data.attendees !== '') {
          // ì°¸ì„ ì¸ì› ì •ë³´ê°€ ìˆì„ ê²½ìš°ì—ë§Œ í‘œì‹œ
          attendeesInfo = `ì°¸ì„ ì¸ì›: ${data.attendees}\n`;
      }
      
      let otherInfoLine = '';
      // 'ê·¸ ì™¸ ì°¸ê°€ì ì •ë³´' í•­ëª©ì´ ìˆì„ ê²½ìš°ì—ë§Œ í‘œì‹œ (ê¸°ì¡´ ë™ë°˜ ì—¬ë¶€ ëŒ€ì²´)
      if (data.otherInfo !== undefined && data.otherInfo !== null && data.otherInfo !== '') {
          otherInfoLine = `ê·¸ ì™¸ ì°¸ê°€ì ì •ë³´: ${data.otherInfo}\n`;
      }


      resultDiv.innerText =
        `âœ… ì‹ ì²­ ë‚´ì—­ í™•ì¸\n\n` +
        `ì´ë¦„: ${data.name}\n` +
        `ì „ê³µ ì„ íƒ: ${data.major}\n` +
        attendeesInfo + // ì¡°ê±´ë¶€ ì°¸ì„ ì¸ì› ì •ë³´
        otherInfoLine + // ì¡°ê±´ë¶€ ê·¸ ì™¸ ì°¸ê°€ì ì •ë³´
        `ì‹ ì²­ ì‹œê°„: ${data.timestamp}` +
        rankMessage;
    }
  } catch (err) {
    console.error("Fetch error:", err);
    checkButton.disabled = false;
    resultDiv.className = "result error";
    resultDiv.innerText = "ìš”ì²­ ì²˜ë¦¬ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤. ì ì‹œ í›„ ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.";
  }
}